{% extends 'base_dashboard.html' %}
{% load static %}

{% block title %}Admin Dashboard | Inventory Management System{% endblock %}

{% block breadcrumb %}
    <span class="current">Admin Dashboard</span>
{% endblock %}

{% block page_title %}Admin Dashboard{% endblock %}

{% block content %}
    <!-- Key Metrics -->
    <div class="metrics-grid">
        <div class="metric-card">
            <div class="metric-header">
                <h3 class="metric-title">Total Revenue</h3>
                <div class="metric-icon blue">
                    <i class="fas fa-dollar-sign"></i>
                </div>
            </div>
            <h2 class="metric-value">₹{{ total_revenue|default:"0" }}</h2>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up mr-1"></i> 12% from last month
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <h3 class="metric-title">Total Orders</h3>
                <div class="metric-icon green">
                    <i class="fas fa-shopping-cart"></i>
                </div>
            </div>
            <h2 class="metric-value">{{ total_orders|default:"0" }}</h2>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up mr-1"></i> 8% from last month
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <h3 class="metric-title">Total Products</h3>
                <div class="metric-icon orange">
                    <i class="fas fa-boxes"></i>
                </div>
            </div>
            <h2 class="metric-value">{{ product_count|default:"0" }}</h2>
            <div class="metric-change negative">
                <i class="fas fa-arrow-down mr-1"></i> 3% from last month
            </div>
        </div>

        <div class="metric-card">
            <div class="metric-header">
                <h3 class="metric-title">Total Employees</h3>
                <div class="metric-icon red">
                    <i class="fas fa-users"></i>
                </div>
            </div>
            <h2 class="metric-value">{{ employee_count|default:"0" }}</h2>
            <div class="metric-change positive">
                <i class="fas fa-arrow-up mr-1"></i> 5% from last month
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Revenue Overview</h3>
                <div class="chart-actions">
                    <select class="text-sm border rounded p-1">
                        <option>Last 7 Days</option>
                        <option>Last 30 Days</option>
                        <option>Last 90 Days</option>
                    </select>
                </div>
            </div>
            <div class="chart-body">
                <canvas id="revenueChart"></canvas>
            </div>
        </div>

        <div class="chart-card">
            <div class="chart-header">
                <h3 class="chart-title">Sales by Category</h3>
                <div class="chart-actions">
                    <select class="text-sm border rounded p-1">
                        <option>This Month</option>
                        <option>Last Month</option>
                        <option>This Year</option>
                    </select>
                </div>
            </div>
            <div class="chart-body">
                <canvas id="categoriesChart"></canvas>
            </div>
        </div>
    </div>

    <!-- Tables & Activity Row -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Recent Orders Table -->
        <div class="lg:col-span-2">
            <div class="chart-card">
                <div class="chart-header">
                    <h3 class="chart-title">Recent Orders</h3>
                    <a href="{% url 'sales_history' %}" class="text-sm text-blue-500 hover:underline">View All</a>
                </div>
                <div class="p-4">
                    <table class="data-table">
                        <thead>
                        <tr>
                            <th>Order ID</th>
                            <th>Customer</th>
                            <th>Date</th>
                            <th>Amount</th>
                            <th>Status</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% if recent_orders %}
                            {% for order in recent_orders %}
                                <tr>
                                    <td>#{{ order.id }}</td>
                                    <td>{{ order.customer.full_name }}</td>
                                    <td>{{ order.date|date:"M d, Y" }}</td>
                                    <td>₹{{ order.total_amount }}</td>
                                    <td>
                                        <span class="status {% if order.status == 'Completed' %}success{% elif order.status == 'Pending' %}warning{% else %}info{% endif %}">
                                            {{ order.status }}
                                        </span>
                                    </td>
                                </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" class="text-center py-4">No recent orders found</td>
                            </tr>
                        {% endif %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Activity Feed -->
        <div class="activity-card">
            <div class="activity-card-header">
                <h3 class="activity-card-title">Recent Activities</h3>
            </div>
            <ul class="activity-list">
                {% if recent_activities %}
                    {% for activity in recent_activities %}
                        <li class="activity-item">
                            <div class="activity-icon {% if activity.action_type == 'create' %}green{% elif activity.action_type == 'update' %}blue{% elif activity.action_type == 'delete' %}red{% else %}orange{% endif %}">
                                {% if activity.action_type == 'create' %}
                                    <i class="fas fa-plus"></i>
                                {% elif activity.action_type == 'update' %}
                                    <i class="fas fa-edit"></i>
                                {% elif activity.action_type == 'delete' %}
                                    <i class="fas fa-trash"></i>
                                {% elif activity.action_type == 'login' %}
                                    <i class="fas fa-sign-in-alt"></i>
                                {% else %}
                                    <i class="fas fa-info-circle"></i>
                                {% endif %}
                            </div>
                            <div class="activity-content">
                                <p class="activity-title">{{ activity.description }}</p>
                                <p class="activity-time">{{ activity.timestamp|timesince }} ago</p>
                            </div>
                        </li>
                    {% endfor %}
                {% else %}
                    <li class="activity-item">
                        <div class="activity-content">
                            <p class="activity-title">No recent activities</p>
                        </div>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
{% endblock %}

{% block extra_js %}
    <script>
        // Revenue Chart
        const revenueCtx = document.getElementById('revenueChart').getContext('2d');
        new Chart(revenueCtx, {
            type: 'line',
            data: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                datasets: [{
                    label: 'Revenue',
                    data: [65000, 59000, 80000, 81000, 56000, 95000, 140000],
                    borderColor: '#1a73e8',
                    backgroundColor: 'rgba(26, 115, 232, 0.1)',
                    tension: 0.3,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });

        // Categories Chart
        const categoriesCtx = document.getElementById('categoriesChart').getContext('2d');
        new Chart(categoriesCtx, {
            type: 'doughnut',
            data: {
                labels: ['Electronics', 'Clothing', 'Food', 'Home & Garden', 'Others'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        '#1a73e8', '#34a853', '#fbbc05', '#ea4335', '#9334e6'
                    ]
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false
            }
        });
    </script>
{% endblock %}